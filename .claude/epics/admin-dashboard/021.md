---
name: unit-tests-admin
epic: admin-dashboard
status: open
priority: high
stream: D
depends_on: ["001", "002", "003", "004"]
created: 2026-02-19T18:00:22Z
updated: 2026-02-19T18:00:22Z
---

# Task 005: Tests unitarios — componentes y utilidades admin

## Objetivo

Cubrir con tests unitarios (Jest + React Testing Library) los componentes y utilidades del admin dashboard.

## Tests a Crear

### `src/components/admin/__tests__/status-badge.test.tsx`

```typescript
describe('StatusBadge', () => {
  it('renders correct color for "new" status')
  it('renders correct color for "contacted" status')
  it('renders correct color for "won" status')
  it('renders correct color for "lost" status')
  it('renders human-readable label for each status')
})
```

### `src/components/admin/__tests__/stats-card.test.tsx`

```typescript
describe('StatsCard', () => {
  it('renders title and value correctly')
  it('renders subtitle when provided')
  it('handles zero value without errors')
  it('handles large numbers correctly')
})
```

### `src/components/admin/__tests__/leads-table.test.tsx`

```typescript
describe('LeadsTable', () => {
  it('renders table headers correctly')
  it('renders list of leads')
  it('renders "sin leads" when empty array')
  it('formats date correctly')
  it('renders status badge for each lead')
  it('applies correct link to each row')
})
```

### `src/lib/admin/__tests__/verify-admin.test.ts`

```typescript
describe('verifyAdminRequest', () => {
  it('returns 401 when no user session')
  it('returns 403 when user has role "sales"')
  it('returns 403 when user has role "developer"')
  it('returns user and supabase client when role is "admin"')
})
```

### `src/app/admin/login/__tests__/page.test.tsx`

```typescript
describe('AdminLoginPage', () => {
  it('renders email and password fields')
  it('renders submit button')
  it('does NOT render a link to register')
  it('does NOT render a link to public auth pages')
  it('shows error message on failed login attempt')
  it('calls signInWithPassword with correct credentials')
})
```

## Configuración de Tests

- Usar mocks de `@/lib/supabase/server` y `@/lib/supabase/client` para aislar Supabase
- Los mocks ya existen o deben crearse en `src/__mocks__/`
- Agregar al `jest.config.js` si hace falta el path `src/components/admin`

## Criterio Done
- [ ] `npm run test:unit` pasa todos los tests
- [ ] Cobertura de componentes admin > 80%
- [ ] `verifyAdminRequest` cubierto al 100%
- [ ] No hay tests que dependan de Supabase real (mocks correctos)
